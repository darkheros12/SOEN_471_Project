# SOEN_471_Project

## Abstract:
This project is a dataset analysis on statistics related to football. More specifically, this dataset contains statistics on over 18 000 players such as dribbling, passing, shooting, defending, and stamina from data collected by sofifa.com. The data collected are stats spanning from the 2015 to 2021 season. The objective of this project is to apply supervised classification techniques to classify player's position based on their statistics and predict which positions they are most likely to play in. Some of the possible positions for players are goalkeeper, defender, midfielder and attacker.

***

## Introduction:
Football is one of the biggest entertainments in the world. With more than 18 000 professional players across the world, it has become very hard to find players that could be a fit in a football club. As a fanatic of football, we pick an Interest of player's performance on certain position. Players tend to perform better in certain position than others.  There are many positions in football such as full-back, centre-back, sweeper, goalkeeper, wing-back, defensive-midfield, central-midfield, attacking-midfield, forward, winger and striker. All those positions have their effect on the game. Assembling a team with different position is essential to make a more fluid gameplay and bring out the best experience for the players. There are multiple factors that might affect the game such as player’s experience, formations, strategies etc. However, for the scope of this project, we will solely focus on positions.

The main objective is to use the player’s stats from 2015 to 2021 to predict potential player's position based on trained stats. This will allow potential coaches or football adept to use players in their best position.

The current problem is coaches have difficult time to pick players based on their abilities. Often, they would put players in their unpreferred position because no one can fill those holes. During transfer session, it is often hard to find an adequate player to buy because of the uncertainty of their preferred position. Thus, this project is intended to solve the problem of future player based on previous trained models. It will predict if the player is fit for a certain position or not. 

There are a few studies using machine learning algorithms to predict game potential outcome such as “A Machine Learning framework for sport result prediction”. They analyzed different model of ML focusing on ANN (Artificial Neural Network) to predict sport results. Another study made by Hengzhi Chen “Neural Network Algorithm in Predicting Football Match Outcome Based on Player Ability Index” is based on player abilities to affect a football game. It will predict the outcome of the game based on player’s abilities. Plenty of previous studies showed that neural network is crucial for predictions in sports. 

***

## Materials and Methods:
The dataset that is chosen for this project includes all the player statistics for all the players from the popular soccer game Fifa. Those statistics include skills such as shooting, passing, dribbling, defending, and much more. In fact, the dataset contains about 100 columns for each player. A very interesting aspect of this dataset is that it is updated every year when a new Fifa game comes out and therefore the dataset includes player statistics from each Fifa game since the collection began with Fifa 15. Moreover, instead of appending new data to the existing dataset, each Fifa game has its own csv file containing the statistics from that year only, meaning we have data pertaining to Fifa 15, 16, 17 and on until Fifa 21, all in separate files. This is something that will facilitate for us to test on individual sets if we wish. Therefore, we can train on individual sets and compare those models with models trained on all the sets combined. Last thing to note about the chosen dataset is that some cleaning and feature engineering will be applied to it. Given the large number of features in the dataset as mentioned earlier, it is clear that some features give us irrelevant information about a player when the goal is to decide their position on the pitch. Therefore, the dataset will be optimized as much as possible before using it to train our models.

Multiple techniques will be used to achieve the objective. The algorithms that will be used to train our models are decision trees, random forest, and kNN (K-nearest neighbors). Decision tree is an algorithm where at each node we split our training set using the feature that gives us the best information gain. For example, when dealing with instances of two classes, we want instances from one class on one side of the split, and instances from another class on the other side, and so we choose the feature that splits these instances best. Random forests are multiple trees where some randomness is introduced so that we end up with a collection of trees that could predict an outcome. These trees then can “vote” for a class and the predicted class will be the one that is chosen by the most number of trees. KNN algorithm, on the other hand, classifies instances by grouping it with neighbors that it has the most in common with. For each algorithm, the hyperparameters will be tuned to find the most optimal model. For example, we will compare the different results obtained by decision tree model by changing the splitting criterion (gini vs. entropy), before comparing our decision tree model with the KNN model. Moreover, another technique that we are interested in is the naïve bayes classifier, which is not seen in this course. Naïve bayes algorithm classifies an instance by calculating a score for each possible class that the instance can belong to and chooses the class with the highest score. We expect all four of these models to have positives and negatives when faced with a dataset like ours. For example, we know that there are some very discriminative features, such as shooting skills, which differentiates strikers from the rest of the players, and therefore decision trees might give accurate classifications. KNN on the other hand might be useful since we know that players of the same position have a few attributes in common which they excel in. Therefore, it will be interesting to analyze each model carefully and determine what makes one model better than the others for our dataset.

Finally, most of our work will be done using Apache Spark and our data will be stored in a spark dataframe. While PyCharm will be our main IDE, Jupyter Notebook will also be used to help visualize our results better.

https://www.kaggle.com/stefanoleone992/fifa-21-complete-player-dataset

## Results
### Data Preparation

Before we delve into the results of our models, let us go over the data preparation that was required of our dataset.
First of all, as opposed to what was presented during our presentation, our final results came from training our models on the whole dataset from Fifa 15 to Fifa 21, instead of testing only on the Fifa 21 dataset (19,000 entries). Some comments will be made later on about the differences in the results obtained from these two sets. Therefore, our dataset containing statistics from Fifa 15 to Fifa 21 consisted of 122,841 entries. A sample of the original dataset can be seen below:

|sofifa_id|          player_url|       short_name|           long_name|age|       dob|height_cm|weight_kg|nationality|          club_name|         league_name|league_rank|overall|potential|value_eur|wage_eur|player_positions|preferred_foot|international_reputation|weak_foot|
|---------|--------------------|-----------------|--------------------|---|----------|---------|---------|-----------|-------------------|--------------------|-----------|-------|---------|---------|--------|----------------|--------------|------------------------|---------|
|   158023|https://sofifa.co...|         L. Messi|Lionel Andrés Mes...| 33|1987-06-24|      170|       72|  Argentina|       FC Barcelona|Spain Primera Div...|          1|     93|       93| 67500000|  560000|      RW, ST, CF|          Left|                       5|        4|
|    20801|https://sofifa.co...|Cristiano Ronaldo|Cristiano Ronaldo...| 35|1985-02-05|      187|       83|   Portugal|           Juventus|     Italian Serie A|          1|     92|       92| 46000000|  220000|          ST, LW|         Right|                       5|        4|
|   200389|https://sofifa.co...|         J. Oblak|           Jan Oblak| 27|1993-01-07|      188|       87|   Slovenia|    Atlético Madrid|Spain Primera Div...|          1|     91|       93| 75000000|  125000|              GK|         Right|                       3|        3|
|   188545|https://sofifa.co...|   R. Lewandowski|  Robert Lewandowski| 31|1988-08-21|      184|       80|     Poland|  FC Bayern München|German 1. Bundesliga|          1|     91|       91| 80000000|  240000|              ST|         Right|                       4|        4|
|   190871|https://sofifa.co...|        Neymar Jr|Neymar da Silva S...| 28|1992-02-05|      175|       68|     Brazil|Paris Saint-Germain|      French Ligue 1|          1|     91|       91| 90000000|  270000|         LW, CAM|         Right|                       5|        5|
+---------+--------------------+-----------------+--------------------+---+----------+---------+---------+-----------+-------------------+--------------------+-----------+-------+---------+---------+--------+----------------+--------------+------------------------+---------+

Then, from the original dataset, we had to cut down a large chunk of the features for various reasons. Even though we only see a handful of them here, the total number of features amounted to 106, which is a lot of information for one player. For example, we had to cut down many columns because they were identification features for the players, such as 'short_name', 'long_name', 'age', 'dob' (date of birth), 'nationality', 'club_name', 'sofifa_id' (website from which data was extracted), etc. All these are information that don’t tell us anything about a player’s position, therefore we deemed them safe to remove.

Furthermore, we had to remove all goalkeepers from the dataset due to the fact that many features were goalkeeper specific. To elaborate, many features in the dataset only had values that made sense for goalkeepers, such as ‘gk_speed’, ‘gk_positioning’, and ‘gk_diving’, amongst other things. These features only had values for players that were classified as ‘goalkeepers’, and had null values for forwards, midfielders, and defenders. Therefore, we decided to remove goalkeepers completely and only train our models to predict the other positions.

We also noticed that about 60% of our data were players that were unfortunately classified either as a substitute or as a reserve. Essentially, these players would play as forward, midfielder, or defender but were not classified accordingly, and therefore we had to drop them from our dataset, which left us with about 40% of the original data, which still accounted for about 44,300 entries.

We then had to normalize the ratings of each player as the players’ overall rating ranged from 94 (Lionel Messi’s overall rating) to about 47. The problems arise from the fact that Messi and the 47-rated player could both be classified as forwards, but where Messi’s attacking skills are all around 90, the other player’s ratings would be much lower, and therefore it would be hard to draw conclusion from these two ratings. Therefore, we have divided all the attributes of each player by their overall score so we could evaluate them on the same scale and their attributes would be in relation to their overall score. After this process we removed the overall score feature as well as that did not tell us anything about a player’s field position.

Finally, the features were all cleaned up and all noisy inputs were removed, but one last problem remained which was the fact that the data set was imbalanced. At this point there were 7,990 forwards, 18551 midfielders, and 17768 defenders. Even though midfielders and defenders were represented somewhat equally, they were both represented twice as much as forwards. Therefore, we decided to oversample the minority class using a technique called SMOTE. The logic of SMOTE is that it will create lines between a pair of points in the minority class, which is the forwards class in our case, and then create new data points from points that fall in these lines. The new points will then resemble pre-existing data points from the minority class. The result of applying SMOTE to our dataset is shown below:

Before SMOTE:

<div align="center"><img src="Charts/before_smote.png"/></div>
<p align="center">
   Figure 1. categorical features
</p>

After SMOTE:

<div align="center"><img src="Charts/after_smote.png"/></div>
<p align="center">
   Figure 1. categorical features
</p>

Our final dataset contains a total of 55,653 entries with 21 features as shown below:

|       skill_moves|          shooting|           passing|         dribbling|        defending|attacking_crossing|attacking_finishing|attacking_heading_accuracy|attacking_short_passing|attacking_volleys|   skill_dribbling|skill_fk_accuracy|skill_long_passing| movement_agility|  power_shot_power|mentality_interceptions|mentality_positioning|  mentality_vision|mentality_penalties|defending_standing_tackle|defending_sliding_tackle|team_position|
|------------------|------------------|------------------|------------------|-----------------|------------------|-------------------|--------------------------|-----------------------|-----------------|------------------|-----------------|------------------|-----------------|------------------|-----------------------|---------------------|------------------|-------------------|-------------------------|------------------------|-------------|
| 4.301075268817205|  98.9247311827957| 97.84946236559139|102.15053763440861|40.86021505376344| 91.39784946236558| 102.15053763440861|         75.26881720430107|      97.84946236559139| 94.6236559139785| 103.2258064516129|101.0752688172043| 97.84946236559139|97.84946236559139| 92.47311827956989|      43.01075268817204|                100.0|102.15053763440861|  80.64516129032258|       37.634408602150536|      25.806451612903224|      Forward|
| 5.434782608695652|101.08695652173914| 88.04347826086956| 96.73913043478261|38.04347826086957| 91.30434782608695| 103.26086956521738|         97.82608695652173|      89.13043478260869|93.47826086956522| 95.65217391304348| 82.6086956521739| 83.69565217391305|94.56521739130434|102.17391304347827|     31.521739130434785|   103.26086956521738| 89.13043478260869|  91.30434782608695|        34.78260869565217|       26.08695652173913|      Forward|
| 4.395604395604396|             100.0| 85.71428571428571|  93.4065934065934|47.25274725274725| 78.02197802197803| 103.29670329670331|          93.4065934065934|       92.3076923076923| 97.8021978021978|  93.4065934065934| 93.4065934065934| 76.92307692307693|84.61538461538461|  97.8021978021978|      53.84615384615385|   103.29670329670331| 86.81318681318682|   96.7032967032967|        46.15384615384615|       20.87912087912088|      Forward|
|5.4945054945054945|  93.4065934065934|  94.5054945054945|103.29670329670331|39.56043956043956|  93.4065934065934|   95.6043956043956|         68.13186813186813|       95.6043956043956| 95.6043956043956|104.39560439560441| 97.8021978021978| 89.01098901098901|105.4945054945055| 87.91208791208791|      39.56043956043956|     95.6043956043956|  98.9010989010989|  101.0989010989011|       32.967032967032964|      31.868131868131865|      Forward|
| 4.395604395604396|  94.5054945054945|102.19780219780219|  96.7032967032967|70.32967032967034|103.29670329670331|  90.10989010989012|         60.43956043956044|     103.29670329670331|90.10989010989012|  96.7032967032967|91.20879120879121|102.19780219780219|85.71428571428571|             100.0|      72.52747252747253|     96.7032967032967|103.29670329670331|   92.3076923076923|        71.42857142857143|       58.24175824175825|   Midfielder|
+------------------+------------------+------------------+------------------+-----------------+------------------+-------------------+--------------------------+-----------------------+-----------------+------------------+-----------------+------------------+-----------------+------------------+-----------------------+---------------------+------------------+-------------------+-------------------------+------------------------+-------------+